import app from './app';
import * as fs from 'fs';
import * as minimist from 'minimist';

const argv = minimist(process.argv.slice(1));

const PORT = argv.port || 3000;

globalThis.appVersion = '2.0.0';
globalThis.appName = argv.name || 'Pandanite Node';
globalThis.networkName = argv.network || 'mainnet';
globalThis.defaultPeers = ["http://5.9.151.50:3000","http://65.21.224.171:3000","http://65.21.89.182:3000","http://88.119.169.111:3000"];
globalThis.shuttingDown = false;
globalThis.safeToShutdown = true;


process.on('SIGINT', function() {

	globalThis.shuttingDown = true;

console.log("caught sigint")
	
	return new Promise((resolve, reject) => {
    
		var shutdowncheck = setInterval(function() {
			
			console.log('Checking if shutdown is safe... ' + globalThis.safeToShutdown.toString());

			if (globalThis.safeToShutdown == true)
			{
				process.exit(0);
			}
  
		}, 1000);

	});
	
});

app.listen(PORT, () => {

    console.log(`    Pandanite Node v` + globalThis.appVersion);
    console.log(`    @*******************************************************************************
    @*******************************************************************************
    @*******************************************************************************
    @*******************************************************************************
    @*******************************************************************************
    @*******************************************************************************
    @***********,%%%%%%%%&****************** ***************** %%%%%%%%%************
    @******** %%%%%%%%%%%%%%.***/             *,,.     *****%%%%%%%%%%%%%%%*********
    @******* %%%%%%%%%%%%%%%%%                            %%%%%%%%%%%%%%%%%#********
    @*******,%%%%%%%%%%%%%%%%                              %%%%%%%%%%%%%%%% ********
    @*******/%%%%%%%%%%%%%%                                  %%%%%%%%%%%%%% ********
    @********,%%%%%%%%%%(                                       %%%%%%%%%% *********
    @********** %%%%%%                                            %%%%%%%***********
    @***************                                                 ***************
    @*************              %%%%%               %%%%              **************
    @*************        &%%%%%%%%%%%            %%%%%%%%%%%%         *************
    @************         %%@  %%   %%%          %%%  #%   *%%         *************
    @************        .%%  %%%%%  %%%        &%%% #%%%%  %%%        *************
    @************        %%%%      %%%            %%&      %%%%        *************
    @************         %%%%%%%%%%%              .%%%%%%%%%%         *************
    @************          %%%%%%%%                  %%%%%%%%          *************
    @************            %%%%%                     %%%%            *************
    @*************                                                    ,*************
    @*************                      %%%%%%%%(                     **************
    @****************                                              *****************
    @******************                                          *******************
    @**********************             %%%%%%%%#            ***********************
    @*****************************                    .*****************************
    @***********************************        ************************************
    @*******************************************************************************
    @*******************************************************************************
    @*******************************************************************************`);

    console.log('Pandanite node listening on port ' + PORT);
})